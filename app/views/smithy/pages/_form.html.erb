<% content_for :top_content do %>
<% unless @page.root? %>
  <ul class="breadcrumb">
  <%- breadcrumbs = @page.persisted? ? @page.ancestors : @parent.self_and_ancestors -%>
  <% breadcrumbs.each do |p| %>
    <li>
      <%= @page == p ? p.title : link_to(p.title, edit_page_path(p.id)) %>
      <%= content_tag :span, :class => 'divider' do %>/<% end %>
    </li>
  <% end %>
    <%= content_tag(:li, @page.title) if @page.persisted? %>
  </ul>
<% end %>
<% end %>

<%= semantic_form_for @page, :url => ( @page.persisted? ? page_path(@page.id) : pages_path ) do |f| %>
  <%= f.inputs "Page Information" do %>
    <%= f.input :title %>
    <%= f.input :permalink, :hint => "This will be auto-created if blank. Only fill it in if you know what you're doing" %>
    <%= f.input :parent, :include_blank => false, :collection => tree_for_select unless !@page.parent_id? %>
    <%= f.input :show_in_navigation, :label => "Show page in site navigation" %>
    <%= f.input :template, :as => :select, :collection => Smithy::Template.templates, :include_blank => false %>
    <%= render :partial => "smithy/pages/page_fields", :locals => { :f => f } if File.exists?(Rails.root.join('app', 'views', 'smithy', 'pages', '_page_fields.html.erb')) %>
  <% end %>
  <% if @page.persisted? && @page.external_link.blank? %>
    <h3>Content</h3>
    <%= render :partial => "container", :collection => @page.containers, :locals => { :f => f } %>
  <% elsif @page.external_link? %>
    <%= f.inputs "Redirect" do %>
      <%= f.input :external_link, :hint => "This page is currently being redirected to #{link_to @page.external_link, @page.external_link}".html_safe %>
    <% end %>
  <% end %>
  <h3 data-toggle="collapse" data-target="#page-meta">Meta <i class="fa fa-caret-down"></i></h3>
  <%= content_tag :div, :id => "page-meta", :class => "collapse" do %>
    <%= f.inputs do %>
      <%= f.input(:external_link) unless @page.external_link? %>
      <%= f.input :cache_length, :hint => "In seconds (eg. 600 is 10 minutes)" %>
      <%= render :partial => "smithy/pages/meta_fields", :locals => { :f => f } if File.exists?(Rails.root.join('app', 'views', 'smithy', 'pages', '_meta_fields.html.erb')) %>
    <% end %>
  <% end %>
  <h3 data-toggle="collapse" data-target="#page-seo">SEO <i class="fa fa-caret-down"></i></h3>
  <%= content_tag :div, :id => "page-seo", :class => "collapse" do %>
    <%= f.inputs do %>
      <%= f.input :browser_title %>
      <%= f.input :keywords, as: :string, input_html: { maxlength: nil } %>
      <%= f.input :description %>
    <% end %>
  <% end %>

  <%= f.actions do %>
    <% if @page.published? %>
      <%= f.action :submit, :label => "Save and Publish", :button_html => { name: "publish", class: 'btn btn-primary' } %>
      <%= f.action :submit, :label => "Save as Draft and Unpublish", :button_html => { name: "draft", class: 'btn btn-default' } %>
    <% else %>
      <%= f.action :submit, :label => "Save as Draft", :button_html => { name: "draft", class: 'btn btn-primary' } %>
      <%= f.action :submit, :label => "Save and Publish", :button_html => { name: "publish", class: 'btn btn-default' } %>
    <% end %>
  <% end %>
<% end %>
